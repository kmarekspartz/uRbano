---
title: "uRbano Overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{uRbano Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette provides an overview of the `uRbano` package.

## Example Usage

Here is an example of how to use the `uRbano` package to calculate a built density index for a city.

```{r, eval=FALSE}
library(uRbano)
library(ggplot2)

# Get a 30km radius around San Juan
rad <- get_city_radius("San Juan", 30000)

# Extract OpenStreetMap roads within the radius
roads <- extract_osm_roads(rad)

# Get building footprints for Puerto Rico
buildings <- get_buildings("PuertoRico")

# Trim and fix building geometries
buildings <- fix_n_trim_buildings(buildings, rad)

# Transform the data to meters
rad <- transform_to_meters(rad, method = "NAD")
buildings <- st_transform(buildings, crs = st_crs(rad))
roads <- st_transform(roads, crs = st_crs(rad))

# Create a hexagonal grid
r_grid <- radius_hex_grid(rad, 1000)

# Calculate road lengths and building areas by grid cell
rd_lens <- calculate_roads_by_grid(r_grid, roads)
building_ars <- calculate_buildings_by_grid(r_grid, buildings)

# Combine into a density index
building_ars[is.na(building_ars)] <- 0
rd_lens[is.na(rd_lens)] <- 0

r_grid <- r_grid %>%
  mutate(rd_len = rd_lens, building_ars = building_ars) %>%
  mutate(
    rd_lvls = cut(rd_len, 5, labels = 1:5),
    building_lvls = cut(building_ars, 5, labels = 1:5)
  ) %>%
  mutate(dens_dex = as.numeric(rd_lvls) + as.numeric(building_lvls))

# Plot the density index
ggplot(data = r_grid, aes(fill = dens_dex, color = dens_dex)) +
  geom_sf() +
  scale_fill_viridis_b()
```
