---
title: "uRbano Overview"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{uRbano Overview}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, setup}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette provides an overview of the `uRbano` package.

## Example Usage

Here is an example of how to use the `uRbano` package to calculate a built density index for a city.

```{r, eval=FALSE}
library(uRbano)
library(ggplot2)

# Get a 30km radius around San Juan
city_radius <- get_city_radius("San Juan", 30000)

# Extract OpenStreetMap roads within the radius
roads <- extract_osm_roads(city_radius)

# Get building footprints for Puerto Rico
buildings <- get_buildings("PuertoRico")

# Trim and fix building geometries
buildings <- fix_and_trim_buildings(buildings, city_radius)

# Transform the data to meters
city_radius <- transform_crs_to_meters(city_radius, method = "NAD")
buildings <- st_transform(buildings, crs = st_crs(city_radius))
roads <- st_transform(roads, crs = st_crs(city_radius))

# Create a hexagonal grid
hexagonal_grid <- create_hexagonal_grid(city_radius, 1000)

# Calculate road lengths and building areas by grid cell
road_lengths <- calculate_roads_by_grid(hexagonal_grid, roads)
building_areas <- calculate_buildings_by_grid(hexagonal_grid, buildings)

# Combine into a density index
building_areas[is.na(building_areas)] <- 0
road_lengths[is.na(road_lengths)] <- 0

hexagonal_grid <- hexagonal_grid %>%
  mutate(road_length = road_lengths, building_areas = building_areas) %>%
  mutate(
    road_levels = cut(road_length, 5, labels = 1:5),
    building_levels = cut(building_areas, 5, labels = 1:5)
  ) %>%
  mutate(density_index = as.numeric(road_levels) + as.numeric(building_levels))

# Plot the density index
ggplot(data = hexagonal_grid, aes(fill = density_index, color = density_index)) +
  geom_sf() +
  scale_fill_viridis_b()
```
